<div class="layout">
	<h1 class="title">Кто на фото?</h1>
	<div class="score">
		<Score score={state.score} />
	</div>
	<div class="question">
		{#if isLoading}
		<Loading />
		{:elseif isChecking}
		<Checking />
		{:elseif isError}
		<Error />
		{:elseif state.finished}
		<Result score={state.score} />
		{:else}
		<Question {...state.question} on:answer="check(event)" on:next="next()" />
		{/if}
	</div>
</div>

<script>
  import { game } from "./game";
  import Loading from "./Loading.html";
  import Checking from "./Checking.html";
  import Error from "./Error.html";
  import Question from "./Question";
  import Score from "./Score.html";
  import Result from "./Result.html";
  export default {
    components: {
      Loading,
      Checking,
      Error,
      Question,
      Score,
      Result
    },
    data() {
      return {
        state: game.first(),
        isLoading: true,
        isChecking: false,
        isError: false
      };
    },

    oncreate() {
      this.next();
    },

    methods: {
      next() {
        const { state } = this.get();
        this.set({ isLoading: true });
        game
          .next(state)
          .then(newState => this.set({ state: newState }))
          .catch(() => this.set({ isError: true }))
          .then(() => this.set({ isLoading: false }));
      },
      check({ optionId }) {
        const { state } = this.get();
        this.set({ isChecking: true });
        game
          .check(state, optionId)
          .then(newState => this.set({ state: newState }))
          .catch(err => this.set({ isError: true }))
          .then(() => this.set({ isChecking: false }));
      }
    }
  };
</script>

<style>
	.layout {
	  height: 100%;
	}
	.title {
	  text-align: center;
	  font-size: 4rem;
	  line-height: 4rem;
	  padding: 1rem;
	  margin: 0;
	}
	.question {
	  height: calc(100% - 6rem);
	  position: relative;
	}
	.score {
	  position: absolute;
	  top: 0.5rem;
	  right: 0.5rem;
	}
</style>